import argparse
import pandas as pd
from tcrpower import NB2Calibrator, NBVarCalibrator, TCRPowerCalculator

def main(args):
	df = pd.read_csv(args.csvfile)
	modelcalib = NBVarCalibrator(df[args.fraccol].values, 
							     df[args.countcol].values,
							     args.Tread)

	modelfit = modelcalib.fit()
	modelfit.to_csv(args.output)
	print("Done fitting model. Outputed parameters to '{}'.".format(args.output))

if __name__ == "__main__":
	parser = argparse.ArgumentParser("TCRpower")
	parser.add_argument("csvfile", help = "path to .csv with spike-in TCR read count data.")
	parser.add_argument("Tread", type = int, help = "Total number of sequencing reads.")
	parser.add_argument("-output", default = "readcount_model.csv", help = "output file for calibrated model.")
	parser.add_argument("-countcol", 
						default = "A_chain_count",
						help = "Title of data column with read counts.")
	parser.add_argument("-fraccol", 
						default = "TCR_fraction",
						help = "Title of data column with ground truth TCR fractions.")
	main(parser.parse_args())
